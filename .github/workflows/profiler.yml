name: Profiler

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  a100s_Profiling:
    name: A100S Profiling
    runs-on: [self-hosted, linux, a100s]
    steps:
    - uses: actions/checkout@v2
    - name: Change permissions on files
      run: pwd; cd tools/profiling/; chmod +x buildCUDAProcess.sh buildSYCLProcess.sh
    - name: Runs performanceProfiler.py script
      run: pwd; cd ../; source /cvmfs/sft.cern.ch/lcg/contrib/gcc/11.3.0/x86_64-centos8/setup.sh; source /cvmfs/projects.cern.ch/intelsw/oneAPI/linux/x86_64/2022/setvars.sh; python3 madgraph4gpu/tools/profiling/performanceProfiler.py -l 'CUDA' -b 'master'